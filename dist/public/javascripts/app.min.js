let userName,userCoins,userUserName,currentUserId,base_url="https://imdcoin.herokuapp.com";primus=Primus.connect(base_url,{reconnect:{max:1/0,min:500,retries:10}}),primus.on("data",e=>{"updateTransfer"===e.action&&appendTransfer(e.data),"updatePage"==e.action&&fetchUser()});let appendTransfer=e=>{fetch(base_url+"/users/coinsTransfered/"+e.data.transfer.receiver,{method:"put",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({coins:e.data.transfer.coins.$numberDecimal})}).then(e=>e.json()).then(e=>{"success"===e.status&&primus.write({action:"updatePage"}),console.log(e)}).catch(e=>{console.log(e)});let a='<div class="transaction">';"Mina"===e.data.transfer.receiver?a+=`<h5 class="green">Received from</h5>\n      <div class="transaction__header"><h4>${e.data.transfer.sender}</h4><h5 class="green">${e.data.transfer.coins.$numberDecimal} IMDC</h5></div>`:a+=`<h5 class="red">Sended to</h5>\n      <div class="transaction__header"><h4>${e.data.transfer.receiver}</h4><h5 class="red">- ${e.data.transfer.coins.$numberDecimal} IMDC</h5></div>`,a+=`<div class="transaction__body">\n      <h6 class="transaction__subject">${e.data.transfer.reason}</h6>\n      <p class="transaction__description">${e.data.transfer.message}</p>\n    </div>\n    </div>`,document.querySelector("#transactionHistory__title").insertAdjacentHTML("afterend",a)},fetchUser=()=>{fetch(base_url+"/users",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{"success"===e.status&&(userName=e.user.name,userUserName=e.user.username,userCoins=e.user.coins.$numberDecimal,currentUserId=e.user.id,document.querySelector("h1").innerHTML+=" "+userName,document.querySelector(".coinValue").innerHTML=userCoins)}).catch(e=>{console.log(e)})};localStorage.getItem("token")||(window.location.href="/login"),fetchUser(),fetch(base_url+"/api/v1/transfers",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{console.log(e),e.data.transfers.forEach(e=>{let a='<div class="transaction">';e.receiver===userUserName?a+=`<h5 class="green">Received from</h5>\n      <div class="transaction__header"><h4>${e.sender}</h4><h5 class="green">${e.coins.$numberDecimal} IMDC</h5></div>`:a+=`<h5 class="red">Sended to</h5>\n      <div class="transaction__header"><h4>${e.receiver}</h4><h5 class="red">- ${e.coins.$numberDecimal} IMDC</h5></div>`,a+=`<div class="transaction__body">\n      <h6 class="transaction__subject">${e.reason}</h6>\n      <p class="transaction__description">${e.message}</p>\n    </div>\n    </div>`,document.querySelector("#transactionHistory__title").insertAdjacentHTML("afterend",a)})}).catch(e=>{console.log(e),window.location.href="/login"});